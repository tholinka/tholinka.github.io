{"ignition":{"version":"3.5.0"},"storage":{"disks":[{"device":"/dev/sda","partitions":[{"label":"k8s","number":1,"sizeMiB":47684},{"label":"storage","number":2,"sizeMiB":0}],"wipeTable":false}],"files":[{"overwrite":true,"path":"/usr/local/bin/k3s","contents":{"source":"https://github.com/k3s-io/k3s/releases/download/v1.31.3%2Bk3s1/k3s-arm64"},"mode":493},{"path":"/etc/rancher/k3s/kubelet.config","contents":{"compression":"","source":"data:,apiVersion%3A%20kubelet.config.k8s.io%2Fv1beta1%0Akind%3A%20KubeletConfiguration%0AshutdownGracePeriod%3A%2060s%0AshutdownGracePeriodCriticalPods%3A%2010s%0A"},"mode":420},{"path":"/etc/systemd/zram-generator.conf","contents":{"compression":"","source":"data:;base64,IyBUaGlzIGNvbmZpZyBmaWxlIGVuYWJsZXMgYSAvZGV2L3pyYW0wIGRldmljZSB3aXRoIHRoZSBkZWZhdWx0IHNldHRpbmdzClt6cmFtMF0K"},"mode":420},{"overwrite":true,"path":"/etc/sysctl.d/kubernetes.conf","contents":{"compression":"","source":"data:,net.ipv4.ip_forward%3D1%0A"},"mode":420},{"path":"/etc/profile.d/systemd-pager.sh","contents":{"compression":"","source":"data:,%23%20Tell%20systemd%20to%20not%20use%20a%20pager%20when%20printing%20information%0Aexport%20SYSTEMD_PAGER%3Dcat%0A"},"mode":420},{"path":"/etc/sysctl.d/20-silence-audit.conf","contents":{"compression":"","source":"data:,%23%20Raise%20console%20message%20logging%20level%20from%20DEBUG%20(7)%20to%20WARNING%20(4)%0A%23%20to%20hide%20audit%20messages%20from%20the%20interactive%20console%0Akernel.printk%3D4%0A"},"mode":420},{"overwrite":true,"path":"/etc/yum.repos.d/kubernetes.repo","contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/5TMOwoCMRRG4T6LyWW0kUBW4BLEIo+fjNy8yM2Is3tRwX66w1ecG28eo2JC7qq6Anv9g/JOsI1s1zm7GKLOSTRfRD8ahTZgSKbzGYaeiz6faPRCCvVD0S4q9RRWBP4lYz80Gugtuum+UaJ+lawZu3oHAAD//5WyNkuyAAAA"},"mode":420},{"path":"/etc/yum.repos.d/rancher-k3s-common.repo","contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/3TNsQrCMBDG8T1P0VGH9izdhEyObq4ikp5HU9Lkwl069O2lRtwcj9/H/+7iEnqSNgzaIsfIqdXixoUeJrlI9la9uQ7aXD7eHOrgaEantMpifSlZzwCSY/ftdTNDGBTqFGoZkIVYIbET9IbSbi/bmylP6AmD7Y1Q5ufvPu0UaPv3Iq/jMmMXaDPvAAAA//8uNPOyygAAAA=="},"mode":420},{"overwrite":true,"path":"/etc/profile.d/zz-default-editor.sh","contents":{"compression":"","source":"data:,export%20EDITOR%3Dvim%0A"}},{"overwrite":true,"path":"/root/.zprofile","contents":{"compression":"","source":"data:,source%20%2Fhome%2Ftyler%2F.zprofile%0A"},"mode":420},{"overwrite":true,"path":"/root/.zshrc","contents":{"compression":"","source":"data:;base64,ZXhwb3J0IFpTSF9DT05GSUc9Ii9ob21lL3R5bGVyLy56c2gtY29uZmlnIgplY2hvIC1lICJcZVszNm1IaXQgXCJ5XCIgdG8gYWNjZXB0IHRoZSB3YXJuaW5nXGVbMzltIgpzb3VyY2UgL2hvbWUvdHlsZXIvLnpzaC1jb25maWcvenNocmMuenNocmMK"},"mode":420},{"group":{"name":"tyler"},"path":"/home/tyler/.config/systemd/user/default.target.wants/dotfiles.service","user":{"name":"tyler"},"contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/4ySQUsrMRDH7/kUeYV33OReWHhP7cGLilU8lB7S7OxmaHayZCa166eXrRYVWuot8P/lN0zyXz0TylrdAPuMg2Ci+pZYXIy6SdJiBFYvjoRrAnlNeVslikhgxOUORP1vBfKZ7DpRg5PywUlY7JGF6z82pB6sjBGyNT5Ri539e2dYXD8otVpC3qGHtXoaB6gTAYck6hF6h3SYtdij1COwWuzBL8VlqW3hbDdItkPRH0pdVV1MGxd1ydHMgsjAczsBoWyMT72dGSQWcM19qzuUf1/R/Kw6JgJ9wiUhRaSts8cnMxP+Y9Njoqsqgy+ZcQff55xiLYMIUnc4lMFwuHjjjcPv4TPstK6k4oO+8FefRVkfCgLN1Vj3JQpWhSEfO/AeAAD//1JiKlVgAgAA"},"mode":420},{"overwrite":true,"path":"/etc/rancher/k3s/config.yaml","contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/4SPwW6DMAyG73kK1PMMBBjaIu1hTGLaqGnCbFO1bz9RsamHaVOu3/f98XmdCHzJyiUlYrhgxiMxIB+dgeowxRwAQ2AS+WjrxzuYh7Vwud1/wAspRy/whyD+RGFN/9ZJfQC6LUUI9qyrlFcymgQE8+ba966241tt694Yn1ZRYog56o4K8ZXYVSfVRVzTPPFuHIbeSMZFTkV1oyblWYyQZ1IByp7vi8aS99h338fArrJtPXTbVxs7vnRta53HmdzQOde8jo/l6OkJ7n+Be+caazszJ8yZEsTlOsIF5XOfDFFwSrSdqow0x7OBak+nyUCViscEooXxSOYrAAD//0DW9PDIAQAA"},"mode":420}],"filesystems":[{"device":"/dev/disk/by-partlabel/k8s","format":"btrfs","mountOptions":["rw","relatime","compress=zstd:2","ssd","discard=async","space_cache=v2","autodefrag","subvolid=5","subvol=/"],"path":"/var/lib/rancher/k3s","wipeFilesystem":false},{"device":"/dev/disk/by-partlabel/storage","format":"btrfs","mountOptions":["rw","relatime","compress=zstd:2","ssd","discard=async","space_cache=v2","autodefrag","subvolid=5","subvol=/"],"path":"/var/lib/longhorn","wipeFilesystem":false}],"links":[{"path":"/etc/localtime","target":"../usr/share/zoneinfo/America/Chicago"}]},"systemd":{"units":[{"contents":"# Generated by Butane\n[Unit]\nRequires=systemd-fsck@dev-disk-by\\x2dpartlabel-k8s.service\nAfter=systemd-fsck@dev-disk-by\\x2dpartlabel-k8s.service\n\n[Mount]\nWhere=/var/lib/rancher/k3s\nWhat=/dev/disk/by-partlabel/k8s\nType=btrfs\nOptions=rw,relatime,compress=zstd:2,ssd,discard=async,space_cache=v2,autodefrag,subvolid=5,subvol=/\n\n[Install]\nRequiredBy=local-fs.target","enabled":true,"name":"var-lib-rancher-k3s.mount"},{"contents":"# Generated by Butane\n[Unit]\nRequires=systemd-fsck@dev-disk-by\\x2dpartlabel-storage.service\nAfter=systemd-fsck@dev-disk-by\\x2dpartlabel-storage.service\n\n[Mount]\nWhere=/var/lib/longhorn\nWhat=/dev/disk/by-partlabel/storage\nType=btrfs\nOptions=rw,relatime,compress=zstd:2,ssd,discard=async,space_cache=v2,autodefrag,subvolid=5,subvol=/\n\n[Install]\nRequiredBy=local-fs.target","enabled":true,"name":"var-lib-longhorn.mount"},{"contents":"[Unit]\nDescription=Layer packages with rpm-ostree\nWants=network-online.target\nAfter=network-online.target\n# We run before `zincati.service` to avoid conflicting rpm-ostree\n# transactions.\nBefore=zincati.service\nConditionPathExists=!/var/lib/%N.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\n# `--allow-inactive` ensures that rpm-ostree does not return an error\n# if the package is already installed. This is useful if the package is\n# added to the root image in a future Fedora CoreOS release as it will\n# prevent the service from failing.\nExecStart=/usr/bin/rpm-ostree override remove docker-cli moby-engine containerd\nExecStart=/usr/bin/systemctl disable docker.service docker.socket containerd.service\nExecStart=/usr/bin/rpm-ostree install -y --allow-inactive vim zsh k3s-selinux htop iotop\nExecStart=/bin/touch /var/lib/%N.stamp\nExecStart=/bin/systemctl --no-block reboot\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"rpm-ostree-install-packages.service"},{"contents":"[Unit]\nDescription=Change shell to zsh\nConditionPathExists=/usr/bin/zsh\nConditionPathExists=!/var/lib/%N.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/usr/bin/chsh -s /usr/bin/zsh tyler\nExecStart=/usr/bin/shsh -s /usr/bin/zsh root\nExecStart=/bin/touch /var/lib/%N.stamp\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"change-to-zsh.service"},{"contents":"[Unit]\nDescription=Run K3s\nWants=network-online.target\nAfter=network-online.target\nConditionPathExists=/var/lib/rpm-ostree-install-packages.stamp\n\n[Service]\nType=notify\nEnvironmentFile=-/etc/default/%N\nEnvironmentFile=-/etc/sysconfig/%N\nEnvironmentFile=-/etc/systemd/system/%N.env\n# put K3S_TOKEN=\u003cyour token\u003e in this file, and set it so only root can read it\nEnvironmentFile=/var/lib/rancher/k3s/token.env\nKillMode=process\nDelegate=yes\nLimitNOFILE=1048576\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nTimeoutStartSec=0\nRestart=always\nRestartSec=5s\nExecStartPre=-/sbin/modprobe br_netfilter\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/local/bin/k3s server\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"k3s.service"},{"contents":"[Unit]\nDescription=Cleanup pods terminated by node shutdown\nWants=k3s.service\nConditionPathExists=/var/lib/rpm-ostree-install-packages.stamp\n\n[Service]\nType=oneshot\nEnvironment=KUBECONFIG=/etc/rancher/k3s/k3s.yaml\nExecStart=/usr/local/bin/k3s kubectl delete pods --field-selector status.phase=Failed -A --ignore-not-found=true\nRestart=on-failure\nRestartSec=30\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"k3s-cleanup-shutdown-pods.service"}]}}
